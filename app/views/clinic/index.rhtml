<html>
  <head>
    <title>Clinic</title>
    <script type="text/javascript" language="javascript" src="/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer ></script>
    <script src="/touchscreentoolkit/lib/javascripts/standard.js"> </script>
    <%= javascript_include_tag("jquery") %>
    <meta http-equiv='content-type' content='text/html;charset=UTF-8' />
    
    <style>
      table td img{
        height: 34px;
        width: 32px;
      }
      .emergencyPopup {
          position: relative;
          background-color: #fff;
          border: 1px solid #aaa;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
          padding: 15px;
          z-index: 1000;
          min-height: 39%;
          max-height: 39%;
          width: 400px;
          left: 31%;
          margin-top: 5%;
          border-radius: 15px;
    }

    .confirmatory_buttons{
      position: relative;
      margin-top: 20%;
      margin-left: -15px;
      margin-right: -14px;
    }
    #shield{
      position:fixed;
      top:0%;
      width:100%;
      height:100%;
      background-color:#000000;
      filter:alpha(opacity=60);
      opacity:0.6;
      -moz-opacity:0.6;
      z-index:100;
      text-align:center;
      vertical-align:middle;
    }
    
    </style>
    
    <script language="javascript">
      tstUsername = "<%= current_user rescue "" %>";
      tstCurrentDate = "<%= @date %>";
      tt_cancel_destination = '/logout';
      tt_cancel_show = '/people/search';
      
	  function resetRegimen(){
		element = document.getElementById('nextButton')
		element.setAttribute("onmousedown", "gotoNextPage()")
	  }
	  
		function showDHISupdate(msg){
			if(!document.getElementById("popupBox")){
				var  popupBox = document.createElement("div");
				popupBox.id = "popupBox";
				popupBox.style.display = "none";
			   
				popupBox.innerHTML = msg + "<br>" + "<button style='width: 200px;margin-top:20px;margin-left:101px;' onmousedown='popupBox.style.display = \"none\"; " +
		"'><span>OK</span></button>";
			   
				document.getElementById("content").appendChild(popupBox);
			}
		
			document.getElementById("popupBox").style.display = "block";
			document.getElementById("popupBox").style.width = "400px";
		}
        function processEmergencyData(){
          if (currentGender == ""){
            return false;
          }
          else{

              jQuery.ajax({
                type: "POST",
                url: "/patients/process_emergency_data/",
                data: "gender=" + currentGender,
                success: function(patientID){
                  window.location = "/patients/dashboard_print_temporary_id?patient_id=" + patientID;
                }
              });
          }
        }
        
        function setEmergencyButton(){
          $("button[link='Emergency']")[0].onclick = function(){
            showEmergencyPopup();
          }
          $("button[link='Emergency']")[0].className = 'red';
        }
        window.setInterval("setEmergencyButton();", 300);
        
        var currentGender = "";
        function selectGender(gender){
            unchecked='/touchscreentoolkit/lib/images/unchecked.png';
            checked = '/touchscreentoolkit/lib/images/checked.png';
            activeClass = document.getElementsByClassName("active")[0];
            
            if (activeClass){
              activeClass.className="";
              imgTag = activeClass.getElementsByTagName("img")[0];
              imgTag.src =  unchecked;
            }

            activeGender = document.getElementById(gender);
            activeGender.className = "active";
            imgTag = activeGender.getElementsByTagName("img")[0];
            imgTag.src =  checked;
            currentGender = gender;
      }

      function cancelEmergencyPopup(){
        currentGender = "";
        unchecked='/touchscreentoolkit/lib/images/unchecked.png';
        document.getElementById("male").getElementsByTagName("img")[0].src =  unchecked;
        document.getElementById("female").getElementsByTagName("img")[0].src =  unchecked;
        document.getElementById("shield").style.display='none';
        document.getElementsByClassName("emergencyPopup")[0].style.display = 'none';        
      }
      function showEmergencyPopup(){
        document.getElementById("shield").style.display='block';
        document.getElementsByClassName("emergencyPopup")[0].style.display = 'block';
      }
    </script>
  </head>
  <body><div id='content'>
      <div id='description' style='color:#777;position:absolute;margin-top:-70px;'></div><center>
        <form id = 'home' action=''>
          <table cellpadding=10>
            <tr>
              <th colspan=2>Home Page</th>
            </tr>
            <h1 id='project_name'>
              <div style="font-size: 0.8em; margin-top: 28px;">
                <%location_name = (@location.downcase == "outpatient" ? "OPD" : "OPD") 
                  if current_user.activities.include?('Manage Lab Orders') or current_user.activities.include?('Manage Lab Results') or
                  current_user.activities.include?('Manage Sputum Submissions') or current_user.activities.include?('Manage TB Clinic Visits') or
                  current_user.activities.include?('Manage TB Reception Visits') or current_user.activities.include?('Manage TB Registration Visits') or
                  current_user.activities.include?('Manage HIV Status Visits') %>
                    <span style="font-size: 55px;">OPD</span>
                <%else%>
                  <%= location_name %>
               <%end%>
              </div>
            </h1>

            <div id="facility"><%= @facility %></div>
            <div id="location"><%= @location %></div>
            <% retrospective = 'false'
               retrospective = 'true' if session[:datetime]
            %>
            <div id="date" retrospective="<%= retrospective %>"><%= @date %></div>
            <div id="user"><%= @user %></div>

            <select id="tabs">
              <option value='/clinic/overview_tab'>Overview</option>
              <option value='/clinic/reports_tab'>Reports</option>
              <%if @location == 'Chronic Cough'%>
                <option value='/clinic/lab_tab'>Laboratory</option>
              <%end%>
              <% if current_user.admin? %>
                <option value='/clinic/properties_tab'>Properties</option>
              <%end%>
              <option value='/clinic/administration_tab'>Administration</option>
            </select>
            <select id="links">

              <option value='/logout' link='/logout'>Logout</option>
<%# Show Find / Register Patient button on HIV Reception and Find by Name button
on the rest of the stations %>

              <%# if @location =~ /HIV Reception/ %>
                <option value='/people/search' link='/people/search' ttSize="295px">Find or Register Patient</option>
              <%# else %>
                <!--<option value='/people/search' link='/people/search' ttSize="200px">Find By Name</option>-->
              <%# end %>
              <option>Emergency</option>
<%# Hide Find by ARV Number button on non-HIV workstations %>
              <% if @location =~ /HIV/ %>
                <option value="/people/find_by_arv_number" ttSize="265px">Find By ARV Number</option>
              <% end %>
              <% if development_environment? %>
                <option value='/location?from=clinic' ttSize="100px">Swap Desk</option>
              <% end %>

              <option value='<%= ((session[:datetime].to_date rescue '') != '' ?
                          "/people/reset_datetime" : "/people/set_datetime") %>'  ttSize="100px">
                <%= ((session[:datetime].to_date rescue '') != '' ? "Reset Date" : "Set Date") %></option>
              <!--option link='regimen.html'>Regimen</option-->
            </select>
           
			<% if params[:dhis_status] == "SUCCESS" %>
				<script> showDHISupdate('DHIS2 update <%="#{params[:dhis_status].downcase}"%>'); </script>
			<% elsif !params[:dhis_status].blank? %>
				<script> showMessage('DHIS2 update <%="#{params[:dhis_status]}"%>'); </script>
			<% end%>

            
            <tr>
              <td align='center'>
                <input type='submit' value='Finish' />
              </td>
            </tr>
          </table>
        </form>
      </center>
    </div>
<!-----------------EMERGENCY POPUP -->
<div id="shield" style="display:none">
  
</div>
<div style="display: none;" class="emergencyPopup">
    <center><span><b style="font-size:14pt;">Select Gender</b>
    </span></center>

    <table width="30%;" align="center" cellspacing="0" style="margin-top:10%;">
      <tr style="cursor: pointer;">
        <td onmousedown="selectGender('male');" id="male" class="" style="border-bottom: 1px solid black"><img src='/touchscreentoolkit/lib/images/unchecked.png' height='45' /></td>
        <td onmousedown="selectGender('male');" style="border-bottom: 1px solid black">Male</td>
      </tr>
      <tr style="cursor: pointer;">
        <td onmousedown="selectGender('female');" id="female" class=""><img src='/touchscreentoolkit/lib/images/unchecked.png' height='45' /></td>
        <td onmousedown="selectGender('female');">Female</td>
      </tr>
    </table>
    <div style="border-top:1px solid black" class="confirmatory_buttons">
      <button onmousedown="" class="button red" onclick="cancelEmergencyPopup()">
          <span>Cancel</span>
      </button>
      <button onmousedown="processEmergencyData();" class="button green" id="okayButton" style="float:right;">
          <span>Okay</span>
      </button>
    </div>
  </div>
<!-- EMERGENCY POPUP --->
  </body>
</html>
